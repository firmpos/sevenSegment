/*
	Seven Segmented Display
	Ash Craig - ashcraig.com

    SevenSegment:   a simple approach to building a segmented
					display without complicated canvas routines
					or font flicker.

                    uses jquery but could easily
                    be adapted for vanilla js

					(see bottom for demo)

*/
class SevenSegment {
    constructor(prop) {
        var _this = this;

        if (typeof (prop.container) == 'undefined') {
            _this.container = $('body')
        } else {
            _this.container = $(prop.container)
        }

        _this.map       = prop.map || '88:88';
        _this.val       = prop.val || '00:00';

        // the main container
        _this._container = $(`
			<div class="svn-segment-container"></div>
		`);

        // insert the display container into the prop.container
        _this.container.append(_this._container);

        // this is the segment container
        _this._segmentview = $(`
			<div class="svn-segment-top"></div>
		`);

        // this is the segment faded background
        _this._segmentview_bk = $(`
			<div class="svn-segment-bk"></div>
		`);

        // the segment svg source
        _this.segments = {
            "segment": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L-5.68434189e-14,15.2 L-5.68434189e-14,98 L5.24271845,98 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M6.01941748,191 L18.0582524,178.6 L18.0582524,115.2 L6.01941748,103 L5.24271845,102 L-5.68434189e-14,102 L-5.68434189e-14,184.8 L6.01941748,191 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "space": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 200"/>`,
            ".": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 200"> <path d="M29.5027781,157.2 C31.0511652,157.2 32.5995523,156.874797 34.1479394,156.22439 C35.6963265,155.573984 36.9866491,154.728455 38.0189072,153.687805 C39.0511652,152.647154 39.8898749,151.346341 40.5350362,149.785366 C41.1801975,148.22439 41.5027781,146.663415 41.5027781,145.102439 C41.5027781,143.541463 41.1801975,141.980488 40.5350362,140.419512 C39.8898749,138.988618 39.0511652,137.752846 38.0189072,136.712195 C36.8576168,135.541463 35.5672943,134.630894 34.1479394,133.980488 C32.9866491,133.460163 31.438262,133.2 29.5027781,133.2 C27.5672943,133.2 26.0189072,133.460163 24.8576168,133.980488 C23.5672943,134.630894 22.2769717,135.541463 20.9866491,136.712195 C19.954391,137.752846 19.1156814,138.988618 18.4705201,140.419512 C17.8253588,141.980488 17.5027781,143.541463 17.5027781,145.102439 C17.5027781,146.663415 17.8253588,148.22439 18.4705201,149.785366 C19.1156814,151.346341 19.954391,152.647154 20.9866491,153.687805 C22.0189072,154.728455 23.3092297,155.573984 24.8576168,156.22439 C26.4060039,156.874797 27.954391,157.2 29.5027781,157.2 Z"/><svg>`,
            ":": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 200"> <path d="M29.5027781 67.2C31.0511652 67.2 32.5995523 66.8747967 34.1479394 66.2243902 35.6963265 65.5739837 36.9866491 64.7284553 38.0189072 63.6878049 39.0511652 62.6471545 39.8898749 61.3463415 40.5350362 59.7853659 41.1801975 58.2243902 41.5027781 56.6634146 41.5027781 55.102439 41.5027781 53.5414634 41.1801975 51.9804878 40.5350362 50.4195122 39.8898749 48.9886179 39.0511652 47.7528455 38.0189072 46.7121951 36.8576168 45.5414634 35.5672943 44.6308943 34.1479394 43.9804878 32.9866491 43.4601626 31.438262 43.2 29.5027781 43.2 27.5672943 43.2 26.0189072 43.4601626 24.8576168 43.9804878 23.5672943 44.6308943 22.2769717 45.5414634 20.9866491 46.7121951 19.954391 47.7528455 19.1156814 48.9886179 18.4705201 50.4195122 17.8253588 51.9804878 17.5027781 53.5414634 17.5027781 55.102439 17.5027781 56.6634146 17.8253588 58.2243902 18.4705201 59.7853659 19.1156814 61.3463415 19.954391 62.6471545 20.9866491 63.6878049 22.0189072 64.7284553 23.3092297 65.5739837 24.8576168 66.2243902 26.4060039 66.8747967 27.954391 67.2 29.5027781 67.2zM29.5027781 157.2C31.0511652 157.2 32.5995523 156.874797 34.1479394 156.22439 35.6963265 155.573984 36.9866491 154.728455 38.0189072 153.687805 39.0511652 152.647154 39.8898749 151.346341 40.5350362 149.785366 41.1801975 148.22439 41.5027781 146.663415 41.5027781 145.102439 41.5027781 143.541463 41.1801975 141.980488 40.5350362 140.419512 39.8898749 138.988618 39.0511652 137.752846 38.0189072 136.712195 36.8576168 135.541463 35.5672943 134.630894 34.1479394 133.980488 32.9866491 133.460163 31.438262 133.2 29.5027781 133.2 27.5672943 133.2 26.0189072 133.460163 24.8576168 133.980488 23.5672943 134.630894 22.2769717 135.541463 20.9866491 136.712195 19.954391 137.752846 19.1156814 138.988618 18.4705201 140.419512 17.8253588 141.980488 17.5027781 143.541463 17.5027781 145.102439 17.5027781 146.663415 17.8253588 148.22439 18.4705201 149.785366 19.1156814 151.346341 19.954391 152.647154 20.9866491 153.687805 22.0189072 154.728455 23.3092297 155.573984 24.8576168 156.22439 26.4060039 156.874797 27.954391 157.2 29.5027781 157.2z"/> </svg>`,
            "0": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L0,15.2 L0,98 L5.24271845,98 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M6.01941748,191 L18.0582524,178.6 L18.0582524,115.2 L6.01941748,103 L5.24271845,102 L0,102 L0,184.8 L6.01941748,191 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "1": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z"/> </svg>`,
            "2": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M6.01941748,191 L18.0582524,178.6 L18.0582524,115.2 L6.01941748,103 L5.24271845,102 L0,102 L0,184.8 L6.01941748,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "3": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "4": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L-5.68434189e-14,15.2 L-5.68434189e-14,98 L5.24271845,98 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z"/> </svg>`,
            "5": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L-5.68434189e-14,15.2 L-5.68434189e-14,98 L5.24271845,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "6": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L-5.68434189e-14,15.2 L-5.68434189e-14,98 L5.24271845,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M6.01941748,191 L18.0582524,178.6 L18.0582524,115.2 L6.01941748,103 L5.24271845,102 L-5.68434189e-14,102 L-5.68434189e-14,184.8 L6.01941748,191 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "7": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z"/> </svg>`,
            "8": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L-5.68434189e-14,15.2 L-5.68434189e-14,98 L5.24271845,98 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M6.01941748,191 L18.0582524,178.6 L18.0582524,115.2 L6.01941748,103 L5.24271845,102 L-5.68434189e-14,102 L-5.68434189e-14,184.8 L6.01941748,191 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`,
            "9": `<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 120 200"> <path d="M99.223301,18.6 L111.262136,6.2 L105.242718,0 L14.7572816,0 L8.73786408,6.2 L20.776699,18.6 L99.223301,18.6 Z M5.24271845,98 L6.01941748,97 L18.0582524,84.8 L18.0582524,21.4 L6.01941748,9 L0,15.2 L0,98 L5.24271845,98 Z M120,98 L120,15.2 L113.980583,9 L101.941748,21.4 L101.941748,85 L113.786408,97.2 L114.757282,98 L120,98 Z M101.941748,109.4 L111.067961,100.2 L101.941748,90.8 L18.0582524,90.8 L18.0582524,90.6 L8.73786408,100 L18.0582524,109.4 L18.0582524,109.2 L101.941748,109.2 L101.941748,109.4 Z M113.980583,191 L120,184.8 L120,102.2 L114.757282,102.2 L113.786408,103 L101.941748,115.2 L101.941748,178.6 L113.980583,191 Z M105.242718,200 L111.262136,193.8 L99.223301,181.4 L20.776699,181.4 L8.73786408,193.8 L14.7572816,200 L105.242718,200 Z"/> </svg>`
        }

        // create the initial element
        _this.build(prop, _this);
    }
    build (prop, _this){

        /*
            build the segments
                8 = full size
                : = half size
        */

        var map     = _this.map.split("");
        var val     = _this.val.split("");
        var display = '';

        map.forEach(el => {
            if (el == ":" || el == "." || el == " ") {

                if (el == " ") el = "space";

                // half segment
                display = display + `<div class="svn-segment-half">${_this.segments[el]}</div>`;

            } else {
                // full segment
                display = display + `<div class="svn-segment">${_this.segments['segment']}</div>`;
            }
        });

        _this._segmentview_bk.append(display);
        _this._container.append(_this._segmentview_bk);

        display = '';

        // calulate the startup value
        val.forEach(el => {
            if (el == ":" || el == "." || el == " ") {

                if (el == " ") el = "space";

                // half segment
                display = display + `<div class="svn-segment-half">${_this.segments[el]}</div>`;

            } else {
                // full segment
                display = display + `<div class="svn-segment">${_this.segments[el]}</div>`;
            }
        });

        _this._segmentview.append(display);
        _this._container.append(_this._segmentview);

    }
    valChange (val) {
        var     _this = this;

        val = val.split("");
        var display = '';

        // calulate the startup value
        val.forEach(el => {
            if (el == ":" || el == "." || el == " ") {

                // accomodate space
                if (el == " ") el = "space";

                // half segment
                display = display + `<div class="svn-segment-half">${_this.segments[el]}</div>`;

            } else {
                // full segment
                display = display + `<div class="svn-segment">${_this.segments[el]}</div>`;
            }
        });

        _this._segmentview.html(display);
    }
}

/*
  	Seven Segmented Demo
	this is just for the demo and
	can be removed from the
	segment.js script
*/
var DEMO = {
    segments        : [],
    createDisplay   : function(){

        DEMO.segments = new SevenSegment({
            container   : '#display',
            map         : '88:88',
            val         : '00:00'
        });

        var x = 0
        setInterval(() => {
            DEMO.segments.valChange('12:0' + x)
            if (x == 9) {
                x = 0;
            } else {
                x++;
            }
        }, 1000);
    },
    template: function(){},
}

DEMO.createDisplay();
